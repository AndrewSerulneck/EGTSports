<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marc's Parlays - NFL Betting</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="module">
    // Initialize Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    const firebaseConfig = {
        apiKey: "AIzaSyA9FsWV7hA4ow2Xaq0Krx9kCCMfMibkVOQ",
        authDomain: "marcs-parlays.firebaseapp.com",
        databaseURL: "https://marcs-parlays-default-rtdb.firebaseio.com",
        projectId: "marcs-parlays",
        storageBucket: "marcs-parlays.firebasestorage.app",
        messagingSenderId: "631281528889",
        appId: "1:631281528889:web:e3befe34907902387c1de8"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app); // Initialize Auth service

    // Make Firebase services available globally
    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebaseSet = set;
    window.firebaseGet = get;
    window.firebaseOnValue = onValue;
    window.firebaseAuth = auth;
    window.firebaseSignIn = signInWithEmailAndPassword;
    window.firebaseSignOut = signOut;
    window.firebaseAuthStateChanged = onAuthStateChanged;
    </script>

    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow-x: hidden; }
    .gradient-bg { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px; }
    .btn-primary { background: #007bff; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .game-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; }
    .team-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: #f8f9fa; border-radius: 8px; cursor: pointer; margin-bottom: 8px; transition: all 0.2s; }
    .team-row.selected { background: #d4edda; border: 2px solid #28a745; }
    .team-row.disabled { opacity: 0.6; cursor: not-allowed; }
    .team-row.won { background: #d4edda; border: 2px solid #28a745; }
    .team-row.lost { background: #f8d7da; border: 2px solid #dc3545; }
    .team-info { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
    .team-name { font-weight: 600; font-size: 15px; }
    .team-spread { font-weight: 700; font-size: 18px; color: #007bff; white-space: nowrap; min-width: 50px; text-align: right; }
    .final-score-badge { background: #007bff; color: white; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: 600; margin-left: 8px; }
    .final-header { background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px; border: 2px solid #dee2e6; }
    .badge { font-size: 11px; background: #e9ecef; padding: 3px 8px; border-radius: 4px; white-space: nowrap; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="password"], input[type="number"] { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; margin-bottom: 16px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 32px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; }
    .text-center { text-align: center; }
    .text-white { color: white; }
    .mb-2 { margin-bottom: 16px; }
    .mb-4 { margin-bottom: 32px; }
    .hidden { display: none; }
    .payout-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 768px) {
    .payout-grid { grid-template-columns: repeat(2, 1fr); }
    }
    .radio-group { display: flex; gap: 20px; margin-bottom: 16px; }
    .radio-label { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .free-play-badge { background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: 8px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
        // --- AUTHENTICATION STATE ---
        const [user, setUser] = useState(null); // Firebase user object
        const isAdmin = user !== null;          // Logged in state
        const [loginEmail, setLoginEmail] = useState('');
        const [loginPassword, setLoginPassword] = useState('');
        const [loginError, setLoginError] = useState('');
        
        // --- APP STATE ---
        const [showAdminLogin, setShowAdminLogin] = useState(false);
        const [showSubmissions, setShowSubmissions] = useState(false);
        const [games, setGames] = useState([]);
        const [loading, setLoading] = useState(true);
        const [selectedPicks, setSelectedPicks] = useState({});
        const [showConfirmation, setShowConfirmation] = useState(false);
        const [ticketNumber, setTicketNumber] = useState('');
        const [showCheckout, setShowCheckout] = useState(false);
        const [contactInfo, setContactInfo] = useState({ name: '', email: '', phone: '', betAmount: '', confirmMethod: 'email', freePlay: 0 });
        const [showPayment, setShowPayment] = useState(false);
        const [submissions, setSubmissions] = useState([]);
        const [editingSubmission, setEditingSubmission] = useState(null);

        // --- CONSTANTS (ADMIN_PASSWORD is removed as it's no longer used) ---
        const VENMO_USERNAME = 'Marc-Serulneck';
        const MAX_BET = 100;
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbwUU7CtC2OY-jHq3P5W5ytDm02WSuGQ8R8bSmYvsE20sYb7HZHBKJQIcG8n6Z_K6SlW/exec';
        
        // --- AUTHENTICATION HANDLERS ---
        useEffect(() => {
            if (window.firebaseAuthStateChanged) {
                const unsubscribe = window.firebaseAuthStateChanged(window.firebaseAuth, (currentUser) => {
                    setUser(currentUser); // Will be null or the user object
                });
                return () => unsubscribe(); // Cleanup subscription
            }
        }, []);

        const handleAdminLogin = async () => {
            setLoginError('');
            try {
                await window.firebaseSignIn(window.firebaseAuth, loginEmail, loginPassword);
                setShowAdminLogin(false);
                setLoginPassword('');
                setLoginEmail('');
            } catch (error) {
                console.error('Login Error:', error.code, error.message);
                setLoginError('Login failed: Invalid email or password.');
            }
        };
        
        const handleAdminLogout = () => {
            window.firebaseSignOut(window.firebaseAuth);
            setShowSubmissions(false); // Hide submissions when logging out
        }
        
        // --- DATA LOADING & SAVING (Existing Logic) ---
        useEffect(() => {
            loadGames();
            loadSubmissions();
            const interval = setInterval(loadGames, 300000);
            return () => clearInterval(interval);
        }, []);

        const loadGames = async () => {
            setLoading(true);
            try {
                // Fetch games from ESPN
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
                const data = await response.json();

                // Fetch spreads from Firebase
                const spreadsRef = window.firebaseRef(window.firebaseDB, 'spreads');
                const spreadsSnapshot = await window.firebaseGet(spreadsRef);
                const firebaseSpreads = spreadsSnapshot.exists() ? spreadsSnapshot.val() : {};

                const formattedGames = data.events.map((event, index) => {
                    const competition = event.competitions[0];
                    const awayTeam = competition.competitors[1];
                    const homeTeam = competition.competitors[0];
                    const status = event.status.type.state;

                    // Get spreads from Firebase using ESPN ID
                    const savedSpread = firebaseSpreads[event.id] || {};

                    return {
                        id: index + 1,
                        espnId: event.id,
                        date: new Date(event.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' }),
                        time: new Date(event.date).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) + ' ET',
                        awayTeam: awayTeam.team.displayName,
                        homeTeam: homeTeam.team.displayName,
                        awayTeamId: awayTeam.id,
                        homeTeamId: homeTeam.id,
                        awayScore: awayTeam.score || '0',
                        homeScore: homeTeam.score || '0',
                        awaySpread: savedSpread.awaySpread || '',
                        homeSpread: savedSpread.homeSpread || '',
                        status: status,
                        statusDetail: event.status.type.detail,
                        isFinal: status === 'post'
                    };
                });

                setGames(formattedGames);
            } catch (error) {
                console.error('Error loading games:', error);
            }
            setLoading(false);
        };

        const loadSubmissions = () => {
            const stored = localStorage.getItem('marcs-parlays-submissions');
            if (stored) setSubmissions(JSON.parse(stored));
        };

        const saveSubmission = async (submission) => {
            const allSubmissions = [...submissions, submission];
            setSubmissions(allSubmissions);
            localStorage.setItem('marcs-parlays-submissions', JSON.stringify(allSubmissions));

            try {
                await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(submission)
                });

                // Send confirmation (stubs)
                if (submission.contactInfo.confirmMethod === 'email') {
                    //sendEmailConfirmation(submission);
                } else {
                    //sendTextConfirmation(submission);
                }
            } catch (error) {
                console.error('Error saving submission to Google Sheet:', error);
            }
        };

        const saveGames = async () => {
            if (!isAdmin) {
                alert("You must be logged in as an admin to save games.");
                return;
            }
            try {
                const spreadsData = {};
                games.forEach(game => {
                    spreadsData[game.espnId] = {
                        awaySpread: game.awaySpread,
                        homeSpread: game.homeSpread,
                        awayTeam: game.awayTeam,
                        homeTeam: game.homeTeam
                    };
                });

                const spreadsRef = window.firebaseRef(window.firebaseDB, 'spreads');
                await window.firebaseSet(spreadsRef, spreadsData);

                alert('Games and odds saved to Firebase! All users will now see these spreads.');
            } catch (error) {
                // This is the error handler that was being hit due to security rules
                console.error('Error saving to Firebase:', error);
                alert('Error saving spreads. Please try again. (Check Firebase Security Rules)');
            }
        };

        const updateSpread = (gameId, team, value) => {
            setGames(games.map(game =>
                game.id === gameId
                ? { ...game, [team === 'away' ? 'awaySpread' : 'homeSpread']: value }
                : game
            ));
        };

        // --- SUBMISSION LOGIC (Existing Logic) ---
        const toggleTeam = (gameId, teamType) => {
            // ... (Your existing toggleTeam logic)
        };

        const generateTicketNumber = () => {
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substring(2, 8).toUpperCase();
            return `TKT-${timestamp}-${random}`;
        };

        const submitPicks = () => {
            const pickCount = Object.keys(selectedPicks).length;
            if (pickCount < 3) {
                alert('Please select at least 3 picks!');
                return;
            }
            setTicketNumber(generateTicketNumber());
            setShowConfirmation(true);
        };

        const handleCheckoutSubmit = () => {
            const betAmount = parseFloat(contactInfo.betAmount);

            if (!contactInfo.name || !contactInfo.email || !contactInfo.phone) {
                alert('Please fill in all contact information');
                return;
            }

            if (!betAmount || betAmount <= 0) {
                alert('Please enter a valid bet amount');
                return;
            }

            if (betAmount > MAX_BET) {
                alert(`Maximum bet is $${MAX_BET}`);
                return;
            }

            const submission = {
                ticketNumber,
                timestamp: new Date().toISOString(),
                contactInfo: {
                    name: contactInfo.name,
                    email: contactInfo.email,
                    phone: contactInfo.phone,
                    confirmMethod: contactInfo.confirmMethod
                },
                betAmount: betAmount,
                freePlay: 0,
                picks: Object.entries(selectedPicks).map(([gameId, teamType]) => {
                    const game = games.find(g => g.id == gameId);
                    return {
                        gameId: game.espnId,
                        team: teamType === 'away' ? game.awayTeam : game.homeTeam,
                        spread: teamType === 'away' ? game.awaySpread : game.homeSpread,
                        pickedTeamType: teamType
                    };
                }),
                paymentStatus: 'pending'
            };

            console.log('NEW SUBMISSION:', JSON.stringify(submission, null, 2));
            saveSubmission(submission);
            setShowPayment(true);
        };

        const calculateResult = (submission) => {
            let wins = 0;
            let losses = 0;
            let pending = 0;

            submission.picks.forEach(pick => {
                const game = games.find(g => g.espnId === pick.gameId);
                if (!game || !game.isFinal) {
                    pending++;
                    return;
                }
                // ... (Your existing score comparison logic)
                const awayScore = parseInt(game.awayScore);
                const homeScore = parseInt(game.homeScore);
                const spread = parseFloat(pick.spread);

                let won = false;
                if (pick.pickedTeamType === 'away') {
                    const adjustedScore = awayScore + spread;
                    won = adjustedScore > homeScore;
                } else {
                    const adjustedScore = homeScore + spread;
                    won = adjustedScore > awayScore;
                }

                if (won) wins++;
                else losses++;
            });

            const allGamesComplete = pending === 0;
            const parlayWon = allGamesComplete && losses === 0 && wins === submission.picks.length;

            return { wins, losses, pending, allGamesComplete, parlayWon };
        };
        
        const updateSubmissionFreePlay = (index, value) => {
            setSubmissions(prev => prev.map((sub, i) => 
                i === index ? { ...sub, freePlay: value } : sub
            ));
            // Note: Saving this to localStorage or Firebase requires a dedicated button/action
        };
        
        // --- RENDER LOGIC ---

        if (loading) {
            return (
                <div className="gradient-bg" style={{display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh'}}>
                    <div className="text-white" style={{fontSize: '24px'}}>Loading games from ESPN...</div>
                </div>
            );
        }

        // --- SUBMISSIONS VIEW (Admin Only) ---
        if (showSubmissions && isAdmin) {
            return (
                <div className="gradient-bg">
                    <div className="container">
                        <div className="card">
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                                <h1>📊 All Submissions ({submissions.length})</h1>
                                <button className="btn btn-secondary" onClick={() => setShowSubmissions(false)}>Back to Admin</button>
                            </div>
                        </div>
                        {submissions.length === 0 ? (
                            <div className="card text-center">
                                <p>No submissions yet</p>
                            </div>
                        ) : (
                            submissions.slice().reverse().map((sub, idx) => {
                                const actualIndex = submissions.length - 1 - idx;
                                const result = calculateResult(sub);
                                const totalBet = sub.betAmount + (sub.freePlay || 0);

                                return (
                                    <div className="card" key={sub.ticketNumber} style={{ border: sub.paymentStatus === 'paid' ? '3px solid #28a745' : '3px solid #ffc107' }}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '16px', borderBottom: '1px solid #eee', paddingBottom: '16px'}}>
                                            <h3 style={{margin: 0}}>Ticket: {sub.ticketNumber}</h3>
                                            <span className={`badge ${result.parlayWon ? 'btn-success' : result.allGamesComplete ? 'btn-danger' : 'btn-secondary'}`} style={{fontSize: '14px', padding: '6px 12px'}}>
                                                {result.allGamesComplete ? (result.parlayWon ? `WON (${result.wins}-0)` : `LOST (${result.wins}-${result.losses})`) : `PENDING (${result.wins}-${result.losses}-${result.pending})`}
                                            </span>
                                        </div>
                                        <p><strong>Name:</strong> {sub.contactInfo.name}</p>
                                        <p><strong>Email:</strong> {sub.contactInfo.email}</p>
                                        <p><strong>Phone:</strong> {sub.contactInfo.phone}</p>
                                        <p><strong>Bet:</strong> ${sub.betAmount.toFixed(2)}{sub.freePlay > 0 && <span className="free-play-badge">FP: ${sub.freePlay.toFixed(2)}</span>} = ${totalBet.toFixed(2)} Total</p>
                                        <p><strong>Status:</strong> <span style={{color: sub.paymentStatus === 'paid' ? '#28a745' : '#ffc107', fontWeight: 'bold'}}>{sub.paymentStatus.toUpperCase()}</span></p>
                                        <p style={{fontSize: '12px', color: '#888'}}>Submitted: {new Date(sub.timestamp).toLocaleString()}</p>

                                        <div style={{marginTop: '16px'}}>
                                            <h4 style={{marginBottom: '8px'}}>Picks ({sub.picks.length}):</h4>
                                            {sub.picks.map((pick, pIdx) => {
                                                const game = games.find(g => g.espnId === pick.gameId);
                                                const status = game && game.isFinal ? 
                                                    (calculateResult({ picks: [pick] }).parlayWon ? 'won' : 'lost') : 'pending';

                                                return (
                                                    <div key={pIdx} style={{
                                                        padding: '12px',
                                                        background: status === 'won' ? '#d4edda' : status === 'lost' ? '#f8d7da' : '#f8f9fa',
                                                        borderRadius: '8px',
                                                        marginTop: '8px',
                                                        border: status === 'won' ? '2px solid #28a745' : status === 'lost' ? '2px solid #dc3545' : 'none'
                                                    }}>
                                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                            <span><strong>{pick.team}</strong> ({pick.spread})</span>
                                                            {game && game.isFinal && (
                                                                <span style={{fontWeight: 'bold', color: status === 'won' ? '#28a745' : '#dc3545'}}>
                                                                    {status.toUpperCase()}
                                                                </span>
                                                            )}
                                                        </div>
                                                        {game && game.isFinal && (
                                                            <div style={{fontSize: '14px', color: '#666', marginTop: '4px'}}>
                                                                Final: {game.awayTeam} {game.awayScore} - {game.homeScore} {game.homeTeam}
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div style={{display: 'flex', gap: '8px', marginTop: '16px'}}>
                                            <input
                                                type="number"
                                                placeholder="Free play amount"
                                                value={editingSubmission === actualIndex ? (sub.freePlay || 0) : ''}
                                                onChange={(e) => {
                                                    setEditingSubmission(actualIndex);
                                                    updateSubmissionFreePlay(actualIndex, parseFloat(e.target.value) || 0);
                                                }}
                                                style={{flex: 1, marginBottom: 0}}
                                            />
                                            <button
                                                className="btn btn-primary"
                                                onClick={() => {
                                                    alert(`Free play of $${sub.freePlay || 0} saved for ${sub.contactInfo.name}`);
                                                    setEditingSubmission(null);
                                                }}
                                            >
                                                Save Free Play
                                            </button>
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>
            );
        }

        // --- ADMIN VIEW (Logged In) ---
        if (isAdmin) {
            return (
                <div className="gradient-bg">
                    <div className="container">
                        <div className="card">
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '16px', flexWrap: 'wrap', gap: '12px'}}>
                                <h1>Admin Panel</h1>
                                <button className="btn btn-danger" onClick={handleAdminLogout}>
                                    Log Out ({user.email})
                                </button>
                                <button className="btn btn-primary" onClick={saveGames}>
                                    Save All Games and Odds
                                </button>
                                <button className="btn btn-secondary" onClick={() => setShowSubmissions(true)}>
                                    View Submissions ({submissions.length})
                                </button>
                            </div>
                        </div>
                        {games.map(game => (
                            <div className="game-card" key={game.id}>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '16px'}}>
                                    <h3 style={{margin: 0}}>{game.awayTeam} vs. {game.homeTeam}</h3>
                                    <span className="badge">{game.date} | {game.time}</span>
                                </div>
                                <div style={{marginBottom: '10px'}}>
                                    <label style={{display: 'block', marginBottom: '5px', fontWeight: '600'}}>{game.awayTeam} Spread:</label>
                                    <input
                                        type="text"
                                        placeholder="Away Team Spread"
                                        value={game.awaySpread}
                                        onChange={(e) => updateSpread(game.id, 'away', e.target.value)}
                                        style={{marginBottom: '0'}}
                                    />
                                </div>
                                <div>
                                    <label style={{display: 'block', marginBottom: '5px', fontWeight: '600'}}>{game.homeTeam} Spread:</label>
                                    <input
                                        type="text"
                                        placeholder="Home Team Spread"
                                        value={game.homeSpread}
                                        onChange={(e) => updateSpread(game.id, 'home', e.target.value)}
                                        style={{marginBottom: '0'}}
                                    />
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- PUBLIC VIEW (Default) ---
        return (
            <div className="gradient-bg">
                <div className="container">
                    {/* Header with Admin Login Button */}
                    <div className="card" style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                        <h1 style={{color: '#1e3c72'}}>🏈 Marc's Parlays</h1>
                        <button 
                            className="btn btn-secondary" 
                            onClick={() => setShowAdminLogin(true)}
                        >
                            Admin Login
                        </button>
                    </div>

                    {/* Games List */}
                    <div className="card">
                        <h2>Select Your Picks (Min 3)</h2>
                        <p style={{marginBottom: '16px', color: '#6c757d'}}>Click a team to select them against the spread.</p>
                        {games.map(game => (
                            <div className="game-card" key={game.id} style={{padding: '0'}}>
                                <div style={{background: '#f8f9fa', padding: '16px', borderTopLeftRadius: '12px', borderTopRightRadius: '12px', borderBottom: '1px solid #dee2e6'}}>
                                    <div style={{fontWeight: '600', fontSize: '14px', color: '#6c757d', marginBottom: '4px'}}>
                                        {game.date} @ {game.time}
                                    </div>
                                    <div style={{fontWeight: '700'}}>
                                        {game.statusDetail}
                                        {game.isFinal && <span className="final-score-badge">FINAL</span>}
                                    </div>
                                </div>

                                {/* Away Team Row */}
                                <div 
                                    className={`team-row ${selectedPicks[game.id] === 'away' ? 'selected' : ''} ${game.isFinal ? 'disabled' : ''}`} 
                                    onClick={() => !game.isFinal && toggleTeam(game.id, 'away')}
                                >
                                    <div className="team-info">
                                        <span className="team-name">{game.awayTeam}</span>
                                        {game.isFinal && <span className="badge">Score: {game.awayScore}</span>}
                                    </div>
                                    <div className="team-spread">{game.awaySpread || 'TBD'}</div>
                                </div>

                                {/* Home Team Row */}
                                <div 
                                    className={`team-row ${selectedPicks[game.id] === 'home' ? 'selected' : ''} ${game.isFinal ? 'disabled' : ''}`} 
                                    onClick={() => !game.isFinal && toggleTeam(game.id, 'home')}
                                    style={{borderBottomLeftRadius: '12px', borderBottomRightRadius: '12px'}}
                                >
                                    <div className="team-info">
                                        <span className="team-name">{game.homeTeam}</span>
                                        {game.isFinal && <span className="badge">Score: {game.homeScore}</span>}
                                    </div>
                                    <div className="team-spread">{game.homeSpread || 'TBD'}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Footer / Submit Button */}
                    <div className="card text-center">
                        <h2>Your Picks: {Object.keys(selectedPicks).length}</h2>
                        <div className="payout-grid" style={{marginBottom: '16px'}}>
                            {/* Payout Grid (Placeholder) */}
                            {[3, 4, 5, 6].map(count => (
                                <div key={count} style={{background: '#f8f9fa', padding: '10px', borderRadius: '8px', border: count === Object.keys(selectedPicks).length ? '2px solid #007bff' : 'none'}}>
                                    <strong style={{display: 'block'}}>{count} Picks</strong>
                                    <span>x{count === 3 ? '6' : count === 4 ? '11' : count === 5 ? '20' : '30'} Payout</span>
                                </div>
                            ))}
                        </div>
                        <button 
                            className="btn btn-success" 
                            onClick={submitPicks} 
                            disabled={Object.keys(selectedPicks).length < 3}
                            style={{width: '100%', fontSize: '18px'}}
                        >
                            Submit {Object.keys(selectedPicks).length} Picks
                        </button>
                    </div>
                </div>

                {/* --- MODALS --- */}

                {/* Admin Login Modal (New Firebase Auth Implementation) */}
                <div className={`modal ${showAdminLogin && !isAdmin ? 'active' : ''}`}>
                    <div className="modal-content">
                        <h2 className="text-center mb-4">🔒 Admin Login</h2>
                        
                        <input
                            type="email"
                            placeholder="Email"
                            value={loginEmail}
                            onChange={(e) => setLoginEmail(e.target.value)}
                        />
                        <input
                            type="password"
                            placeholder="Password"
                            value={loginPassword}
                            onChange={(e) => setLoginPassword(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleAdminLogin()}
                        />
                        
                        {loginError && (
                            <p style={{ color: '#dc3545', marginBottom: '16px', textAlign: 'center', fontWeight: 'bold' }}>
                                {loginError}
                            </p>
                        )}
                        
                        <button className="btn btn-primary" onClick={handleAdminLogin} style={{width: '100%'}}>
                            Sign In
                        </button>
                        
                        <button className="btn btn-secondary" onClick={() => setShowAdminLogin(false)} style={{width: '100%', marginTop: '10px'}}>
                            Cancel
                        </button>
                    </div>
                </div>

                {/* Confirmation Modal */}
                <div className={`modal ${showConfirmation && !showCheckout ? 'active' : ''}`}>
                    <div className="modal-content">
                        <h2 className="text-center mb-4">Confirm Your Parlay</h2>
                        <p className="text-center mb-2">Ticket #<strong>{ticketNumber}</strong></p>
                        <ul style={{listStyle: 'none', padding: 0, marginBottom: '20px'}}>
                            {Object.keys(selectedPicks).map(gameId => {
                                const game = games.find(g => g.id == gameId);
                                const teamType = selectedPicks[gameId];
                                const teamName = teamType === 'away' ? game.awayTeam : game.homeTeam;
                                const spread = teamType === 'away' ? game.awaySpread : game.homeSpread;
                                return (
                                    <li key={gameId} style={{padding: '8px 0', borderBottom: '1px dotted #eee'}}>
                                        <strong>{teamName}</strong> ({spread})
                                    </li>
                                );
                            })}
                        </ul>
                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                            <button className="btn btn-danger" onClick={() => setShowConfirmation(false)}>Cancel</button>
                            <button className="btn btn-primary" onClick={() => { setShowConfirmation(false); setShowCheckout(true); }}>Proceed to Checkout</button>
                        </div>
                    </div>
                </div>
                
                {/* Checkout Modal */}
                <div className={`modal ${showCheckout ? 'active' : ''}`}>
                    <div className="modal-content">
                        <h2 className="text-center mb-4">Complete Your Bet</h2>
                        
                        {/* Contact Info */}
                        <label style={{marginBottom: '8px', display: 'block'}}>Your Name *</label>
                        <input type="text" value={contactInfo.name} onChange={(e) => setContactInfo({...contactInfo, name: e.target.value})} placeholder="Full Name" />
                        
                        <label style={{marginBottom: '8px', display: 'block'}}>Email *</label>
                        <input type="email" value={contactInfo.email} onChange={(e) => setContactInfo({...contactInfo, email: e.target.value})} placeholder="Email Address" />

                        <label style={{marginBottom: '8px', display: 'block'}}>Phone Number *</label>
                        <input type="tel" value={contactInfo.phone} onChange={(e) => setContactInfo({...contactInfo, phone: e.target.value})} placeholder="Phone Number" />
                        
                        <label style={{marginBottom: '8px', display: 'block'}}>Bet Amount (Max ${MAX_BET}) *</label>
                        <input 
                            type="number" 
                            value={contactInfo.betAmount} 
                            onChange={(e) => setContactInfo({...contactInfo, betAmount: e.target.value})}  
                            placeholder="Enter amount" 
                            min="1"
                            max={MAX_BET}
                            step="0.01"
                        />

                        <label style={{marginBottom: '8px', display: 'block'}}>Confirmation Method *</label>
                        <div className="radio-group">
                            <label className="radio-label">
                                <input 
                                type="radio" 
                                name="confirmMethod" 
                                value="email"
                                checked={contactInfo.confirmMethod === 'email'}
                                onChange={(e) => setContactInfo({...contactInfo, confirmMethod: e.target.value})}
                                />
                                Email
                            </label>
                            <label className="radio-label">
                                <input 
                                type="radio" 
                                name="confirmMethod" 
                                value="text"
                                checked={contactInfo.confirmMethod === 'text'}
                                onChange={(e) => setContactInfo({...contactInfo, confirmMethod: e.target.value})}
                                />
                                Text Message
                            </label>
                        </div>

                        <button className="btn btn-success" onClick={handleCheckoutSubmit} style={{width: '100%', fontSize: '18px', marginTop: '16px'}}>
                            Continue to Payment →
                        </button>

                        {showPayment && (
                            <div style={{marginTop: '32px', paddingTop: '32px', borderTop: '2px solid #e0e0e0'}}>
                                <h3 className="text-center mb-2">💰 Payment</h3>
                                <div style={{background: '#f8f9fa', padding: '20px', borderRadius: '8px', textAlign: 'center', marginBottom: '20px'}}>
                                    <p>Venmo <strong>${contactInfo.betAmount}</strong> to</p>
                                    <p style={{fontSize: '20px', fontWeight: 'bold', color: '#333', marginTop: '8px'}}>@{VENMO_USERNAME}</p>
                                </div>
                                <a
                                    href={`venmo://paycharge?txn=pay&recipients=${VENMO_USERNAME}&amount=${contactInfo.betAmount}&note=${encodeURIComponent("Marc's Parlays - " + ticketNumber)}`}
                                    style={{display: 'block', padding: '16px', background: '#008CFF', color: 'white', textAlign: 'center', textDecoration: 'none', borderRadius: '8px', fontWeight: '600', fontSize: '18px'}}
                                >
                                    V Pay ${contactInfo.betAmount} with Venmo
                                </a>
                                <div style={{marginTop: '16px', padding: '16px', background: '#d1ecf1', border: '2px solid #0c5460', borderRadius: '8px', fontSize: '14px', color: '#0c5460'}}>
                                    <strong>✅ Confirmation:</strong> You will receive a {contactInfo.confirmMethod === 'email' ? 'email' : 'text message'} confirmation shortly.
                                </div>
                            </div>
                        )}
                    </div>
                </div>

            </div>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
